extends ../layouts/default
            
ul
  if (req.isAuthenticated())
    li
      a(href="/users/"+req.user.id, title="Profile") Profile
    li
      a(href="/logout", title="logout") Logout
  else
    li
      a(href="/login", title="Login") Login

block form
  - var action = '/timers'
  if (!timer.isNew)
    - action += '/'+timer.id

  if (typeof errors !== 'undefined')
    .fade.in.alert.alert-block.alert-error
      a.close(data-dismiss="alert", href="javascript:void(0)") x
      ul
        each error in errors
          li= error.type

  .jubotron
    unless open_timer
      form.form-inline(method="post", action=action)
        input#desc.input-xlarge(type='text', name="body", placeholder='What are you working on?')=timer.body
        .gray &nbsp; for &nbsp;
        input#desc.input-small(type='text', name="duration", value="25", style='text-align:center;width:18px;', placeholder='How long?')=timer.body
        .gray &nbsp; minutes &nbsp;
        button.btn.btn-primary(type='submit') Start Timer
        .spacer
    else
      .row
        .span3
          #clock
        .span2
          form(action="/timers/" + open_timer._id + "/stop", method="post")
            .body-timer
              input(type="text", name="body", value=open_timer.body, placeholder="What are you working on?", style="width:225px;")
            input.btn.btn-primary(id="stop-timer", type='submit',value="Stop timer") 
      script
        // Javascript
        $(function() {
          $('div#clock').countdown(new Date('#{open_timer.endedAt}'), function(event) { // Update every second one time only if(event.type != "seconds") return;
            // Calculate the time left
            var timeLeft = [
              event.lasting.minutes,
              event.lasting.seconds
            ];
            // Convert the number to two digits strings
            for(var i = 0; i < timeLeft.length; ++i) {
              timeLeft[i] = (timeLeft[i] < 10 ? '0' : '') + timeLeft[i].toString();
            }
            // Concatenate the strings with : and update the html
            $(this).html(timeLeft.join(':'));

            switch(event.type) {
              case "finished":
                soundManager.play('ding');
              break;
            }
          });
        });

block content
    hr(class="no-top")
    each timer in ended_timers
      .timer
        h4=timer.user.username
        .body  #{timer.body} 
        .time-left for #{timer.duration} 
          form.form-inline(action="/timers/"+timer.id, method="post",style="display:inline;")
            input(type="hidden", name="_method", value="DELETE")
            a.delete(href="#", onclick="$(this).parents('form:first').submit();") delete
